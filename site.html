<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Capivara no Aquático</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/addons/p5.sound.min.js"></script>

    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        height: 100%;
        width: 100%;
      }
      canvas {
        display: block;
      }
      .toast {
        visibility: hidden;
        min-width: 250px;
        background-color: rgba(0, 0, 0, 0.8);
        color: #fff;
        text-align: center;
        border-radius: 4px;
        padding: 12px 20px;
        position: fixed;
        left: 50%;
        bottom: 30px;
        transform: translateX(-50%);
        font-size: 14px;
        z-index: 9999;
        transition: visibility 0s, opacity 0.5s ease;
        opacity: 0;
      }

      .toast.show {
        visibility: visible;
        opacity: 1;
      }
    </style>
  </head>
  <body>
    <div id="toast" class="toast"></div>

    <script>
      let capivara;
      let capivaraStanding;
      let capivaraAtual;
      let capivaraX;
      let boias = [];
      let pedras = [];
      let fundo;
      let fundoCancun;
      let vidas = 3;
      let tempo = 40;
      let pontos = 0;
      let frameContador = 0;
      let pedraImg, boiaLaranja, boiaAzul;
      let gameOverImg, tryAgainIcon;
      let isMobile = false;
      let arrastando = false;
      let capivaraSurfista;
      let capivaraSurfistaPulando;
      let velocidadeBonus = 0;
      let fundoBaleia, fundoMalibu;
      let capivaraPai, capivaraPaiPulando;
      let capivaraMae, capivaraMaePulando;
      let modoAvancado = false;
      let marco150Ativado = false;
      let marco250Ativado = false;
      let marco350Ativado = false;
      let musicaFundo;
      let lastBackPress = 0;

      function preload() {
        fundo = loadImage(
          "https://aquaticaamericanpark.com.br/wp-content/uploads/2025/08/fundo.jpg"
        );
        fundoCancun = loadImage(
          "https://aquaticaamericanpark.com.br/wp-content/uploads/2025/08/fundo-cancun.jpg"
        );
        capivara = loadImage(
          "https://aquaticaamericanpark.com.br/wp-content/uploads/2025/08/capivara.png"
        );
        capivaraStanding = loadImage(
          "https://aquaticaamericanpark.com.br/wp-content/uploads/2025/08/capivara-standing.png"
        );
        capivaraSurfista = loadImage(
          "https://aquaticaamericanpark.com.br/wp-content/uploads/2025/08/capivara-surfista-1.svg"
        );
        capivaraSurfistaPulando = loadImage(
          "https://aquaticaamericanpark.com.br/wp-content/uploads/2025/08/capivara-surfista-pulando-1.png"
        );
        pedraImg = loadImage(
          "https://aquaticaamericanpark.com.br/wp-content/uploads/2025/08/gelo.png"
        );
        boiaLaranja = loadImage(
          "https://aquaticaamericanpark.com.br/wp-content/uploads/2025/08/boia_laranja.png"
        );
        boiaAzul = loadImage(
          "https://aquaticaamericanpark.com.br/wp-content/uploads/2025/08/boia_azul.png"
        );
        gameOverImg = loadImage(
          "https://aquaticaamericanpark.com.br/wp-content/uploads/2025/08/game-over.png"
        );
        tryAgainIcon = loadImage(
          "https://aquaticaamericanpark.com.br/wp-content/uploads/2025/08/try-again.svg"
        );
        fundoBaleia = loadImage(
          "https://aquaticaamericanpark.com.br/wp-content/uploads/2025/08/fundo-baleia.jpg"
        );
        fundoMalibu = loadImage(
          "https://aquaticaamericanpark.com.br/wp-content/uploads/2025/08/fundo-malibu.jpg"
        );
        capivaraPai = loadImage(
          "https://aquaticaamericanpark.com.br/wp-content/uploads/2025/08/capivara-pai.png"
        );
        capivaraPaiPulando = loadImage(
          "https://aquaticaamericanpark.com.br/wp-content/uploads/2025/08/capivara-pai-pulando.png"
        );
        capivaraMae = loadImage(
          "https://aquaticaamericanpark.com.br/wp-content/uploads/2025/08/capivara-mae.png"
        );
        capivaraMaePulando = loadImage(
          "https://aquaticaamericanpark.com.br/wp-content/uploads/2025/08/capivara-mae-pulando.png"
        );
        musicaFundo = loadSound(
          "https://aquaticaamericanpark.com.br/wp-content/uploads/2025/08/Musica-capivaras.mp3"
        );
      }

      function setup() {
        createCanvas(windowWidth, windowHeight);
        capivaraX = width / 2;
        capivaraAtual = capivara;
        isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        setInterval(() => {
          if (tempo > 0 && vidas > 0) tempo--;
        }, 1000);
        document.addEventListener("touchmove", (e) => e.preventDefault(), {
          passive: false,
        });
        musicaFundo.loop();
        document.addEventListener("visibilitychange", () => {
          if (document.hidden) {
            musicaFundo.pause();
          } else {
            if (!musicaFundo.isPlaying()) {
              musicaFundo.loop();
            }
          }
        });
      }

      function showToast(message, duration = 3000) {
        const toast = document.getElementById("toast");
        toast.textContent = message;
        toast.classList.add("show");

        setTimeout(() => {
          toast.classList.remove("show");
        }, duration);
      }

      window.onpopstate = function (event) {
        showToast("Pressione novamente para sair");
        history.pushState(null, null, location.href);
      };

      history.pushState(null, null, location.href);

      function windowResized() {
        resizeCanvas(windowWidth, windowHeight);
        capivaraX = constrain(capivaraX, 0, width);
      }

      function draw() {
        background(255);
        let imgAspect = fundo.width / fundo.height;
        let canvasAspect = width / height;
        let drawWidth,
          drawHeight,
          offsetX = 0,
          offsetY = 0;
        if (canvasAspect > imgAspect) {
          drawWidth = width;
          drawHeight = width / imgAspect;
          offsetY = (height - drawHeight) / 2;
        } else {
          drawHeight = height;
          drawWidth = height * imgAspect;
          offsetX = (width - drawWidth) / 2;
        }
        let fundoAtual = fundo;
        if (pontos >= 300) fundoAtual = fundoMalibu;
        else if (pontos >= 200) fundoAtual = fundoBaleia;
        else if (pontos >= 100) fundoAtual = fundoCancun;

        image(fundoAtual, offsetX, offsetY, drawWidth, drawHeight);
        velocidadeBonus = Math.floor(pontos / 80);

        if (!marco150Ativado && pontos >= 100) {
          tempo = 30;
          vidas = 3;
          marco150Ativado = true;
          modoAvancado = true;
        }
        if (!marco250Ativado && pontos >= 200) {
          tempo = 30;
          vidas = 3;
          marco250Ativado = true;
        }
        if (!marco350Ativado && pontos >= 300) {
          tempo = 20;
          vidas = 3;
          marco350Ativado = true;
        }
        let escalaCapivara = height * 0.16;
        let escalaItens = height * 0.12;
        let itemSize = escalaItens * 0.6;
        let imagemCapivaraFinal;
        if (pontos >= 300)
          imagemCapivaraFinal = arrastando ? capivaraMaePulando : capivaraMae;
        else if (pontos >= 200)
          imagemCapivaraFinal = arrastando ? capivaraPaiPulando : capivaraPai;
        else if (modoAvancado)
          imagemCapivaraFinal = arrastando
            ? capivaraSurfistaPulando
            : capivaraSurfista;
        else imagemCapivaraFinal = capivaraAtual;

        image(
          imagemCapivaraFinal,
          capivaraX - escalaCapivara / 2,
          height - escalaCapivara - 20,
          escalaCapivara,
          escalaCapivara
        );
        if (!isMobile) {
          if (keyIsDown(LEFT_ARROW)) capivaraX -= 5;
          if (keyIsDown(RIGHT_ARROW)) capivaraX += 5;
        }
        capivaraX = constrain(capivaraX, 0, width);
        frameContador++;
        let aumentoFrequencia = 1 + Math.floor(pontos / 50) * 0.2;
        let intervalo = Math.floor((isMobile ? 75 : 60) / aumentoFrequencia);

        if (frameContador % intervalo === 0) gerarItem();
        let baseVelocidade = isMobile ? 8 : 12;
        let velocidade = baseVelocidade * (1 + 0.1 * velocidadeBonus);
        for (let i = pedras.length - 1; i >= 0; i--) {
          let p = pedras[i];
          image(pedraImg, p.x, p.y, itemSize, itemSize);
          p.y += velocidade;
          if (
            dist(p.x, p.y, capivaraX, height - itemSize / 2 - 20) < itemSize
          ) {
            vidas--;
            pedras.splice(i, 1);
          } else if (p.y > height) pedras.splice(i, 1);
        }
        for (let i = boias.length - 1; i >= 0; i--) {
          let b = boias[i];
          image(b.tipo, b.x, b.y, itemSize, itemSize);
          b.y += velocidade;
          if (
            dist(b.x, b.y, capivaraX, height - itemSize / 2 - 20) < itemSize
          ) {
            if (b.tipo === boiaLaranja || b.tipo === boiaAzul) tempo += 2;
            pontos += 5;
            boias.splice(i, 1);
          } else if (b.y > height) boias.splice(i, 1);
        }
        if (vidas > 0 && tempo > 0) {
          let textSizeVal = height * 0.03;
          let lineHeight = textSizeVal * 1.2;
          fill(255);
          stroke(0, 128);
          strokeWeight(1.4);
          textSize(textSizeVal);
          textAlign(LEFT, TOP);
          textStyle(BOLD);
          text(`⏱️ Tempo: ${tempo}`, 20, 20);
          text(`❤️ Vidas: ${vidas}`, 20, 20 + lineHeight);
          text(`⭐ Pontos: ${pontos}`, 20, 20 + lineHeight * 2);
          noStroke();
        }
        if (vidas <= 0 || tempo <= 0) {
          noLoop();
          fill(0, 0, 0, 102);
          rect(0, 0, width, height);
          let centerX = width / 2;
          let centerY = height / 2;
          let imgW = isMobile ? width * 0.98 : width * 0.6;
          let imgH = imgW * (gameOverImg.height / gameOverImg.width);
          if (isMobile && imgH < height * 0.2) {
            imgH = height * 0.2;
            imgW = imgH * (gameOverImg.width / gameOverImg.height);
          }
          image(
            gameOverImg,
            centerX - imgW / 2,
            centerY - imgH / 2 - 120,
            imgW,
            imgH
          );
          textAlign(CENTER, CENTER);
          textSize(height * 0.05);
          fill(255);
          stroke(0);
          strokeWeight(1.4);
          textStyle(BOLD);
          text(`⭐ Pontos: ${pontos}`, centerX, centerY);
          noStroke();

          let iconSize = height * 0.08;
          let iconX = centerX - iconSize / 2;
          let iconY = centerY + 70;
          image(tryAgainIcon, iconX, iconY, iconSize, iconSize);
          textSize(height * 0.035);
          fill(255);
          stroke(0);
          strokeWeight(1);
          let textY = iconY + iconSize + 25;
          text("Tentar novamente", centerX, textY);
          noStroke();
          tryAgainArea = {
            x: iconX,
            y: iconY,
            w: iconSize,
            h: iconSize + 30,
            centerX: centerX,
            textY: textY,
            textSize: height * 0.035,
          };
        }
      }

      function gerarItem() {
        if (random() < 0.45) pedras.push({ x: random(width), y: 0 });
        else
          boias.push({
            x: random(width),
            y: 0,
            tipo: random([boiaLaranja, boiaAzul]),
          });
      }

      function touchMoved() {
        if (touches.length > 0 && isMobile) {
          capivaraX = constrain(touches[0].x, 0, width);
          capivaraAtual = capivaraStanding;
          arrastando = true;
        }
        return false;
      }

      function mouseDragged() {
        if (!isMobile) {
          capivaraX = constrain(mouseX, 0, width);
          capivaraAtual = capivaraStanding;
          arrastando = true;
        }
        return false;
      }

      function touchEnded() {
        if (isMobile) {
          capivaraAtual = capivara;
          arrastando = false;
        }
      }

      function mouseReleased() {
        if (!isMobile) {
          capivaraAtual = capivara;
          arrastando = false;
        }
      }

      function reiniciarJogo() {
        vidas = 3;
        tempo = 40;
        pontos = 0;
        frameContador = 0;
        pedras = [];
        boias = [];
        modoAvancado = false;
        velocidadeBonus = 0;
        marco150Ativado = false;
        marco250Ativado = false;
        marco350Ativado = false;
        loop();
      }
      function touchStarted() {
        userStartAudio();
        if (!musicaFundo.isPlaying()) {
          musicaFundo.loop();
        }
        if (navigator.vibrate) {
          navigator.vibrate(100);
        }
        if (isMobile) {
          capivaraAtual = capivaraStanding;
          arrastando = true;
        }
      }
      function mousePressed() {
        userStartAudio();
        if (!musicaFundo.isPlaying()) {
          musicaFundo.loop();
        }
        if ((vidas <= 0 || tempo <= 0) && tryAgainArea) {
          let mx = mouseX;
          let my = mouseY;
          let a = tryAgainArea;
          let iconHit =
            mx >= a.x && mx <= a.x + a.w && my >= a.y && my <= a.y + a.w;
          textSize(a.textSize);
          let textW = textWidth("Tentar novamente");
          let textH = a.textSize;
          let textHit =
            mx >= a.centerX - textW / 2 &&
            mx <= a.centerX + textW / 2 &&
            my >= a.textY - textH / 2 &&
            my <= a.textY + textH / 2;
          if (iconHit || textHit) reiniciarJogo();
        }
        return false;
      }
    </script>
  </body>
</html>
